<!DOCTYPE html>
<html >
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    
    <title>django note | Eggward_Han</title>
    <meta name="renderer" content="webkit">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta name="description" content="一个阴暗的小角落">

    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="django note | Eggward_Han">
    <meta name="twitter:description" content="一个阴暗的小角落">

    <meta property="og:type" content="article">
    <meta property="og:title" content="django note | Eggward_Han">
    <meta property="og:description" content="一个阴暗的小角落">

    
    <meta name="author" content="Eggward">
    
    <link rel="stylesheet" href="/css/vno.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

    
    <link rel="icon" href="/images/favicon.ico">
    

    <meta name="generator" content="hexo"/>
    
    <link rel="alternate" type="application/rss+xml" title="Eggward_Han" href="/atom.xml">
    

    <link rel="canonical" href="http://www.eggwardhan.com/2018/03/05/2018-03-05-django-example-note/"/>

                 
</head>

<body class="home-template no-js">
    <script src="//cdn.bootcss.com/jquery/2.1.4/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <span class="mobile btn-mobile-menu">
        <i class="fa fa-list btn-mobile-menu__icon"></i>
        <i class="fa fa-angle-up btn-mobile-close__icon hidden"></i>
    </span>

    
<header class="panel-cover panel-cover--collapsed" style="background-image: url(/images/background-cover.jpg)">
  <div class="panel-main">
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        <a href="/" title="前往 Eggward_Han 的主页"><img src="/images/favicon.ico" width="80" alt="Eggward_Han logo" class="panel-cover__logo logo" /></a>
        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage for Eggward_Han">Eggward_Han</a></h1>
        
        <span class="panel-cover__subtitle panel-subtitle">爱玩儿的码农</span>
        
        <hr class="panel-cover__divider" />
        <p class="panel-cover__description">一个阴暗的小角落</p>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />

        <div class="navigation-wrapper">
          <div>
          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="Visit the blog" class="blog-button">Blog</a></li>
            
              <li class="navigation__item"><a href="/favourite">黄金屋</a></li>
            
              <li class="navigation__item"><a href="/favourite/time.html">时光机</a></li>
            
              <li class="navigation__item"><a href="/favourite/image.html">幻想间</a></li>
            
              <li class="navigation__item"><a href="/aboutme">关于我</a></li>
            
            </ul>
          </nav>
          </div>
          <div>
          <nav class="cover-navigation navigation--social">
  <ul class="navigation">

  <!-- Weibo-->
  

  <!-- Github -->
  
  <li class="navigation__item">
    <a href="https://github.com/Eggwardhan" title="GitHub" target="_blank">
      <i class='social fa fa-github'></i>
      <span class="label">Github</span>
    </a>
  </li>


<!-- Stack Overflow -->
        

  <!-- Google Plus -->
  

<!-- Facebook -->

  
<!-- Twitter -->

  <li class="navigation__item">
    <a href="https://twitter.com/eggwardhan" title="Twitter" target="_blank">
      <i class='social fa fa-twitter'></i>
      <span class="label">Twitter</span>
    </a>
  </li>

  

  <li class="navigation__item">
    <a href="/atom.xml" title="RSS" target="_blank">
      <i class='social fa fa-rss'></i>
      <span class="label">RSS</span>
    </a>
  </li>



  </ul>
</nav>

          </div>
        </div>

      </div>

    </div>

    <div class="panel-cover--overlay cover-purple"></div>
  </div> 
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner">
            <article class="post-container post-container--single">

  <header class="post-header">
    <div class="post-meta">
      <time datetime="2018-03-05T15:08:35.645Z" class="post-list__meta--date date">2018-03-05</time> &#8226; <span class="post-meta__tags tags">于 
  <a class="tag-link" href="/tags/django/">django</a>
 </span>
      <span class="page-pv">
       Read <span id="busuanzi_value_page_pv"><i class="fa fa-spinner fa-spin"></i></span>
      </span> 
   
    </div>
    <h1 class="post-title">django note</h1>
  </header>

  <section class="post">
    <h3 id="QuerySet-and-managers"><a href="#QuerySet-and-managers" class="headerlink" title="QuerySet and managers"></a>QuerySet and managers</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from django.contrib.auth.models import User</span><br><span class="line">&gt;&gt;&gt; from blog.models import Post</span><br><span class="line">&gt;&gt;&gt; user = User.objects.get(username=&apos;admin&apos;)  #get方法允许你从数据库中取回唯一对象</span><br><span class="line">&gt;&gt;&gt; post = Post.objects.create(title=&apos;One more post&apos;,</span><br><span class="line">                        slug=&apos;one-more-post&apos;,</span><br><span class="line">                        body=&apos;Post body.&apos;,</span><br><span class="line">                        author=user)</span><br><span class="line">&gt;&gt;&gt; post.save()</span><br></pre></td></tr></table></figure>
<p>ＯＲＭ是基于queryset的。QuerySet是从你的数据中按条件采集对象。每个Ｄｊａｎｇｏ　models　至少有一个manager,默认叫做objects.若要获取每一个对象</p>
<p>>&gt;&gt;　all_posts= Post.objects.all()</p>
<hr>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter()"></a>filter()</h3><p>过滤查询集的方法　</p>
<p>>&gt;&gt;Post.objects.filter(publish__year=2018)</p>
<p>或者多个字段过滤=<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;Post,objects.filter(publish__year=2018,author__username=&apos;admin&apos;)</span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;Post,objects.filter(publish__year=2018).filter(author__username=&apos;admin&apos;)</span><br></pre></td></tr></table></figure></p>
<h3 id="exclude"><a href="#exclude" class="headerlink" title="exclude()"></a>exclude()</h3><p>排除　　方法同上</p>
<h3 id="order-by"><a href="#order-by" class="headerlink" title="order_by(  )"></a>order_by(  )</h3><p>Post.objects.order_by(‘title’)# 默认升序，可加负号来指定降序</p>
<h3 id="delete"><a href="#delete" class="headerlink" title="delete()"></a>delete()</h3><p>获取对象后使用</p>
<hr>
<h3 id="添加模型管理器"><a href="#添加模型管理器" class="headerlink" title="添加模型管理器"></a>添加模型管理器</h3><ol>
<li>添加额外 manager,  如 Post.object.my_manager()<br>2.　继承 manager , Post.my_manager.all()</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class PublishedManager(models.Manager):</span><br><span class="line">  def get_queryset(self):</span><br><span class="line">    return super(PublishedManager,</span><br><span class="line">                 self).get_queryset().filter(status=&apos;published&apos;)</span><br><span class="line"></span><br><span class="line">class Post(models.Model):</span><br><span class="line">    #...</span><br><span class="line">    objects = models.Manager() #the default managers</span><br><span class="line">    published = PublishedManager() #Our custom manager</span><br></pre></td></tr></table></figure>
<h3 id="构建列和详情视图-views"><a href="#构建列和详情视图-views" class="headerlink" title="构建列和详情视图(views)"></a>构建列和详情视图(views)</h3><p>一个ｄｊａｎｇｏ视图就是一个ｐｙ方法，它可以接受一个ｗｅｂ请求然后返回一个web响应。在ｖｉews中通过所有的逻辑处理返回期望的响应。</p>
<p>创建views然后为每个视图定义一个Ｕｒｌ模式，我们将会创建ＨＴＭＬ模板来渲染这些视图生成的数据。每一个视图都会渲染模板传递变量给它然后会返回一个经渲染输出的ＨＴＴＰ响应。</p>
<p>编辑应用下的views.py</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">from django.shortcuts import render,get_object_or_404</span><br><span class="line">from .models import post</span><br><span class="line">def post_list(request):</span><br><span class="line">    posts =Post.published.all()</span><br><span class="line">    return render(request,</span><br><span class="line">      &apos;blog/post/list.html&apos;,</span><br><span class="line">      &#123;&apos;posts&apos;:posts&#125;)</span><br></pre></td></tr></table></figure>
<p>post_list视图将request对象作为唯一参数。！所有的视图都需要有这个参数。获我们先获取了所有状态为已发布的帖子，通过之前创建的 published manager.<br>最后　，我们使用ｄｊａｎｇｏ提供的render()通过给予的模板(template)来渲染帖子列<br>这个函数将request对象作为参数，模板（template）路径以及变量来渲染的给予的模板（template）。它返回一个渲染文本（一般是HTML代码）HttpResponse对象。render()方法考虑到了请求内容，这样任何模板（template）内容处理器设置的变量都可以带入给予的模板（template）中。</p>
<p>添加如下代码到views.py文件中：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">def post_detail(request, year, month, day, post):</span><br><span class="line">    post = get_object_or_404(Post, slug=post,</span><br><span class="line">                                   status=&apos;published&apos;,</span><br><span class="line">                                   publish__year=year,</span><br><span class="line">                                   publish__month=month,</span><br><span class="line">                                   publish__day=day)</span><br><span class="line">    return render(request,</span><br><span class="line">                  &apos;blog/post/detail.html&apos;,</span><br><span class="line">                  &#123;&apos;post&apos;: post&#125;)</span><br></pre></td></tr></table></figure>
<p>这是一个帖子详情视图（view）。这个视图（view）使用year，month，day以及post作为参数通过给予slug和日期来获取到一篇已经发布的帖子。请注意，当我们创建Post模型（model）的时候，我们给slgu字段添加了unique_for_date参数。这样我们可以确保在给予的日期中只有一个帖子会带有一个slug，因此，我们能通过日期和slug取回单独的帖子。在这个详情视图（view）中，我们通过使用get_object_or_404()快捷方法来检索期望的Post。这个函数能取回匹配给予的参数的对象，或者当没有匹配的对象时返回一个HTTP 404（Not found）异常。最后，我们使用render()快捷方法来使用一个模板（template）去渲染取回的帖子。</p>

  </section>

</article>

<section class="read-more">
           
    
        
        
               
            <div class="read-more-item">
                <span class="read-more-item-dim">Older Post</span>
                <h2 class="post-list__post-title post-title"><a href="/2018/02/07/2018-2-8-django-example/" title=""></a></h2>
                <p class="excerpt">
                
                
                &hellip;
                </p>
                <div class="post-list__meta"><time datetime="2018-02-08T06:33:21.924Z" class="post-list__meta--date date">2018-02-07</time> &#8226; <span class="post-list__meta--tags tags">于 </span><a class="btn-border-small" href="/2018/02/07/2018-2-8-django-example/">继续阅读</a></div>
                       
            </div>
        
     
   
   
  
</section>

  

            <footer class="footer">
    <span class="footer__copyright">
        &copy; 2018 Eggward - 本站点采用 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>
       
    </span>
    <span class="footer__copyright">
             - 基于 <a href="http://hexo.io">Hexo</a> 搭建，使用 <a href="https://github.com/monniya/hexo-theme-new-vno ">new-vno</a> 主题，由<a href="https://monniya.com ">@Monniya</a> 修改自 <a href="https://github.com/lenbo-ma/hexo-theme-vno" target="_blank">Vno</a>, 原创出自<a href="http://github.com/onevcat/vno" target="_blank">onevcat</a>
         </span>
       
    
    
</footer>


        </div>
    </div>

     
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-78918255-1', 'auto');
	ga('send', 'pageview');
</script>

    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?9cdad07c755fa23f6aced510c6760e87";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>



    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    
</body>
</html>
